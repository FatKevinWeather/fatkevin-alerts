
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fat Kevin Weather Alerts</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      color: #222;
      padding: 10px;
    }
    .alert-box {
      background: #fff;
      margin: 10px 0;
      padding: 10px;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
      border-left: 5px solid #ccc; /* Default */
    }
    .alert-title {
      font-weight: bold;
    }

    /* Flash animation for tornado alerts */
    @keyframes flash {
      0%   { background-color: #d9534f; }
      50%  { background-color: #fff; }
      100% { background-color: #d9534f; }
    }
    .flash-alert {
      animation: flash 1s infinite;
    }
  </style>
</head>
<body>
  <h2>Active Weather Alerts</h2>
  <div id="alerts">Loading alerts...</div>

  <script>
    const countiesToInclude = [
      "Benton", "Washington", "Carroll", "Madison", "Crawford", "Franklin", "Johnson", "Pope", "Sebastian", "Logan", "Scott", "Yell", "Polk",
      "Delaware", "Adair", "Sequoyah", "Le Flore", "McCurtain", "Pushmataha", "Latimer", "Pittsburg", "Haskell", "McIntosh", "Muskogee", "Okmulgee",
      "Cherokee", "Wagoner", "Tulsa", "Mayes", "Rogers"
    ];

    const severityColorMap = {
      "Extreme": "#d9534f",
      "Severe": "#f0ad4e",
      "Moderate": "#ffd966",
      "Minor": "#5bc0de",
      "Unknown": "#ccc"
    };

    function fetchAlerts() {
      fetch("https://api.weather.gov/alerts/active")
        .then(response => response.json())
        .then(data => {
          const alertsDiv = document.getElementById("alerts");
          alertsDiv.innerHTML = "";

          const alerts = data.features.filter(alert => {
            const areaDesc = alert.properties.areaDesc;
            return countiesToInclude.some(county =>
              areaDesc.includes(county) || areaDesc.includes(county + " County")
            );
          });

          if (alerts.length === 0) {
            alertsDiv.innerHTML = "<p>No active alerts for your area.</p>";
          } else {
            alerts.forEach(alert => {
              const box = document.createElement("div");
              const severity = alert.properties.severity;
              const event = alert.properties.event;
              const borderColor = severityColorMap[severity] || "#ccc";

              box.className = "alert-box";
              box.style.borderLeft = `5px solid ${borderColor}`;

              if (event.toLowerCase().includes("tornado")) {
                box.classList.add("flash-alert");
              }

              box.innerHTML = `
                
    const effectiveTime = new Date(alert.properties.effective);
    const expiresTime = new Date(alert.properties.expires);
    const now = new Date();

    if (expiresTime < now) return;

    box.innerHTML = `
      <div class="alert-title">${alert.properties.headline}</div>
                <div>${alert.properties.description}</div>
                <div><strong>Effective:</strong> ${new Date(alert.properties.effective).toLocaleString()}</div>
                <div><strong>Expires:</strong> ${new Date(alert.properties.expires).toLocaleString()}</div>
                <div><strong>Severity:</strong> ${severity}</div>
              `;
              alertsDiv.appendChild(box);
            });
          }
        })
        .catch(error => {
          console.error("Error fetching alerts:", error);
          document.getElementById("alerts").innerHTML = "<p>Error loading alerts.</p>";
        });
    }

    fetchAlerts();
    setInterval(fetchAlerts, 300000);
  </script>
</body>
</html>
