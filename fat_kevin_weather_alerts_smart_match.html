const countiesToInclude = [
  // Your list of counties
];

function normalizeName(name) {
  return name.toLowerCase()
             .replace(/ county/g, '')
             .replace(/, ar/g, '')
             .replace(/, ok/g, '')
             .trim();
}

function fetchAlerts() {
  fetch("https://api.weather.gov/alerts/active")
    .then(response => response.json())
    .then(data => {
      const alertsDiv = document.getElementById("alerts");
      alertsDiv.innerHTML = "";

      const alerts = data.features.filter(alert => {
        const senderName = alert.properties.senderName;
        const areaList = alert.properties.areaDesc.split(',').map(area => normalizeName(area));

        if (senderName === "NWS Tulsa OK") {
          return true; // Accept all alerts from Tulsa
        }

        if (senderName === "NWS Little Rock AR") {
          // Accept only if the alert pertains to specified Arkansas counties
          return areaList.some(area =>
            countiesToInclude.some(county =>
              normalizeName(county).includes(area) || area.includes(normalizeName(county))
            )
          );
        }

        // Exclude alerts from other offices
        return false;
      });

      if (alerts.length === 0) {
        alertsDiv.innerHTML = "<p>No active alerts for your area.</p>";
      } else {
        alerts.forEach(alert => {
          const box = document.createElement("div");
          box.className = "alert-box";
          box.innerHTML = `
            <div class="alert-title">${alert.properties.headline}</div>
            <div>${alert.properties.description}</div>
            <div><strong>Event:</strong> ${alert.properties.event}</div>
            <div><strong>Effective:</strong> ${new Date(alert.properties.effective).toLocaleString()}</div>
            <div><strong>Expires:</strong> ${new Date(alert.properties.expires).toLocaleString()}</div>
          `;
          alertsDiv.appendChild(box);
        });
      }
    })
    .catch(error => {
      console.error("Error fetching alerts:", error);
      document.getElementById("alerts").innerHTML = "<p>Error loading alerts.</p>";
    });
}

fetchAlerts();
setInterval(fetchAlerts, 300000);
